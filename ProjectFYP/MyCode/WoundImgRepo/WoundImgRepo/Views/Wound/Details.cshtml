@model WoundDetailsViewModel
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    .box {
        margin: 0px 0px 10px 0px;
    }

    div > p {
        display: inline-block;
        margin-right: 10px;
        margin-bottom: 10px;
        font-weight: bold;
    }

    button {
        margin-top: 10px;
    }
</style>
<!--Zooming set up-->
<style>
    * {
        box-sizing: border-box;
    }

    .img-zoom-container {
        position: relative;
    }

    .img-zoom-lens {
        position: absolute;
        border: 1px solid #d4d4d4;
        /*set the size of the lens:*/
        width: 40px;
        height: 40px;
    }

    .img-zoom-result {
        border: 1px solid #d4d4d4;
        /*set the size of the result div:*/
        width: 440px;
        height: 444px;
    }
</style>
<script>
    function imageZoom(imgID, resultID) {
        var img, lens, result, cx, cy;
        img = document.getElementById(imgID);
        result = document.getElementById(resultID);
        /*create lens:*/
        lens = document.createElement("DIV");
        lens.setAttribute("class", "img-zoom-lens");
        /*insert lens:*/
        img.parentElement.insertBefore(lens, img);
        /*calculate the ratio between result DIV and lens:*/
        cx = result.offsetWidth / lens.offsetWidth;
        cy = result.offsetHeight / lens.offsetHeight;
        /*set background properties for the result DIV:*/
        result.style.backgroundImage = "url('" + img.src + "')";
        result.style.backgroundSize = (img.width * cx) + "px " + (img.height * cy) + "px";
        /*execute a function when someone moves the cursor over the image, or the lens:*/
        lens.addEventListener("mousemove", moveLens);
        img.addEventListener("mousemove", moveLens);
        /*and also for touch screens:*/
        lens.addEventListener("touchmove", moveLens);
        img.addEventListener("touchmove", moveLens);
        function moveLens(e) {
            var pos, x, y;
            /*prevent any other actions that may occur when moving over the image:*/
            e.preventDefault();
            /*get the cursor's x and y positions:*/
            pos = getCursorPos(e);
            /*calculate the position of the lens:*/
            x = pos.x - (lens.offsetWidth / 2);
            y = pos.y - (lens.offsetHeight / 2);
            /*prevent the lens from being positioned outside the image:*/
            if (x > img.width - lens.offsetWidth) { x = img.width - lens.offsetWidth; }
            if (x < 0) { x = 0; }
            if (y > img.height - lens.offsetHeight) { y = img.height - lens.offsetHeight; }
            if (y < 0) { y = 0; }
            /*set the position of the lens:*/
            lens.style.left = x + "px";
            lens.style.top = y + "px";
            /*display what the lens "sees":*/
            result.style.backgroundPosition = "-" + (x * cx) + "px -" + (y * cy) + "px";
        }
        function getCursorPos(e) {
            var a, x = 0, y = 0;
            e = e || window.event;
            /*get the x and y positions of the image:*/
            a = img.getBoundingClientRect();
            /*calculate the cursor's x and y coordinates, relative to the image:*/
            x = e.pageX - a.left;
            y = e.pageY - a.top;
            /*consider any page scrolling:*/
            x = x - window.pageXOffset;
            y = y - window.pageYOffset;
            return { x: x, y: y };
        }
    }
</script>

<!--zooming end of set-->
@if (TempData["Msg"] != null)
{
    <div class="alert alert-@TempData["MsgType"]">
        @TempData["Msg"]
    </div>
}
<h2 class="mt-4 mb-4">Wound Record</h2>

<!-- versions navigation tab -->
<ul class="nav nav-tabs" id="myTab" role="tablist">
    @{ var count = 0; }
    @foreach (var woundRecord in Model.woundRecordList)
    {
        count += 1;
        var versionId = "version" + count;
        var versionTab = versionId + "-tab";
        if (count == 1)
        {
            //active
            <li class="nav-item">
                <a class="nav-link active" id="@versionTab" data-toggle="tab" href="#@versionId" role="tab" aria-controls="@versionId" aria-selected="true">@woundRecord.versionname</a>
            </li>
        }
        else
        {
            //non active
            <li class="nav-item">
                <a class="nav-link" id="@versionTab" data-toggle="tab" href="#@versionId" role="tab" aria-controls="@versionId" aria-selected="false">@woundRecord.versionname</a>
            </li>
        }
    }
</ul>

<!-- each wound record has same wound image with multiple annotation/mask image in different version -->
<!-- versions navigation tab content -->
<div class="tab-content" id="myTabContent">
    <!-- get this wound record -->
    @{ count = 0; }
    @foreach (var woundRecord in Model.woundRecordList)
    {
        count += 1;
        var versionId = "version" + count;
        var versionTab = versionId + "-tab";
        var showActive = count == 1 ? "show active" : "";
    <div class="tab-pane fade @showActive" id="@versionId" role="tabpanel" aria-labelledby="@versionTab">
        <div class="img-zoom-container">
            <div class="row mt-4">
                <div class="col-xs-6 col-sm-5 box">
                    <h4>Wound</h4>
                    <div class="border">
                        <!-- get this wound image -->
                        <img src="/photos/@woundRecord.imagefile" id="myimage"  class="img-fluid" alt="Responsive image" width="500" height="540" />
                    </div>
                </div>

                <div class="col-xs-6 col-sm-5 ">
                    <h4>Zoom display</h4>
                    <div class="border">
                        <!-- get this wound image -->
                        <div  class="img-zoom-result" id="myresult" alt="Responsive image"  />
                    </div>
                </div>
            </div>
            </div>
            <div class="row mt-4">
                @if (woundRecord.annotationMaskImage.Count > 0)
                {
                    <div class="col-xs-6 col-sm-5">
                        <h4>Annotations</h4>
                    </div>
                    <div class="col-xs-6 col-sm-5">
                        <h4>Masks</h4>
                    </div>
                    <div class="col-xs-6 col-sm-2">
                    </div>
                }
                @foreach (AnnotationMaskImage ai in woundRecord.annotationMaskImage)
                {
                    <div class="col-xs-6 col-sm-5 box">
                        <div class="border">
                            <img src="~/photos/@ai.annotationimagefile" class="img-fluid" alt="Responsive image" />
                        </div>
                    </div>
                    <div class="col-xs-6 col-sm-5 box">
                        <div class="border">
                            <img src="~/photos/@ai.maskimagefile" class="img-fluid" alt="Responsive image" />
                        </div>
                    </div>
                    <div class="col-xs-6 col-sm-2 box">
                        @if (User.IsInRole("Admin") || User.IsInRole("Annotator"))

                        {
                            <a type="button"
                               class="btn btn-primary"
                               asp-controller="wound"
                               asp-action="DeleteAnnotationMaskImage"
                               asp-route-woundid="@woundRecord.woundid"
                               asp-route-annotationid="@ai.annotationid"
                               onclick="return confirm('Delete Annotation and Mask Image')">
                                Delete
                            </a>
                        }
                    </div>
                }

                <div class="col-xs-12 col-sm-12 mt-4">
                    <div><p>Wound Name:</p><span>@Model.woundRecord.woundname</span></div>
                    <div><p>Wound Stage:</p><span>@Model.woundRecord.woundstage</span></div>
                    <div><p>Remarks:</p><span>@Model.woundRecord.woundremarks</span></div>
                    <div><p>Wound Category:</p><span>@Model.woundRecord.woundcategoryname</span></div>
                    <div><p>Wound Location:</p><span>@Model.woundRecord.woundlocationname</span></div>
                    <div><p>Tissue:</p><span>@Model.woundRecord.tissuename</span></div>
                    <!-- get this wound version name -->
                    <div><p>Version:</p><span>@woundRecord.versionname</span></div>
                    @if (User.IsInRole("Admin") || User.IsInRole("Annotator"))
                    {
                        <button type="button" class="btn btn-primary mt-0" data-toggle="modal" data-target="#annotationMaskModal">
                            Upload
                        </button>
                        <a type="button"
                           class="btn btn-primary mr-1"
                           asp-controller="Wound"
                           asp-action="Update"
                           asp-route-id="@Model.woundRecord.woundid">
                            Edit
                        </a>
                    }
                </div>
            </div>
        </div>
        }
    </div>
<script>
    // Initiate zoom effect:
    imageZoom("myimage", "myresult");
</script>
<!-- upload annotation/mask modal window -->
<div class="modal fade" id="annotationMaskModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="exampleModalLabel">Upload File</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form asp-controller="Wound" asp-action="UpdateAnnotationMaskImage" method="post" enctype="multipart/form-data">
                    <input type="hidden" asp-for="@Model.woundRecord.woundid" />
                    <input type="hidden" asp-for="@Model.woundRecord.woundname" />
                    <div class="form-group row">
                        <label class="col-sm-4" asp-for="@Model.woundRecord.annotationimage">Annotation Image:</label>
                        <div class="col-sm-6">
                            <input type="file" asp-for="@Model.woundRecord.annotationimage">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4" asp-for="@Model.woundRecord.maskimage">Mask Image:</label>
                        <div class="col-sm-6">
                            <input type="file" asp-for="@Model.woundRecord.maskimage">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4">Image Version:</label>
                        <div class="col-sm-6">
                            <input type="hidden" asp-for="@Model.woundRecord.versionid" />
                            <select class="form-control" asp-for="@Model.woundRecord.versionname" asp-items="@((SelectList)ViewData["version"])">
                                <option value="0">--Select--</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="offset-sm-4 col-sm-6">
                            <input class="btn btn-primary" type="submit" value="Upload">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
